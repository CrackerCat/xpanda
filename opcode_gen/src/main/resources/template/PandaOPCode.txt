package jmp0.abc.disasm.types;

import lombok.Getter;

@Getter
public enum PandaOPCode {
/*replace padding*/
    private final int code;
    private final String name;
    private final PandaOPCodeFormat format;
    private final int flags;
    PandaOPCode(int code,String name,PandaOPCodeFormat format,int flags) {
        this.code = code;
        this.name = name;
        this.format = format;
        this.flags = flags;
    }

    public static PandaOPCode getLastInstruction(){
        return PandaOPCode.CALLRUNTIME_NOTIFYCONCURRENTRESULT_PREF_NONE;
    }

    public boolean isAccRead(){
        int accReadFlag = PandaOPCodeFlag.ACC_READ.getValue();
        return (this.getFlags() & accReadFlag) == accReadFlag;
    }

    public boolean isAccWrite(){
        int accWriteFlag = PandaOPCodeFlag.ACC_WRITE.getValue();
        return (this.getFlags() & accWriteFlag) == accWriteFlag;
    }

    public boolean isReturnIns(){
        int returnFlag = PandaOPCodeFlag.RETURN.getValue();
        return (this.getFlags() & returnFlag) == returnFlag;
    }

    public boolean isJumpIns(){
        int jumpFlag = PandaOPCodeFlag.JUMP.getValue();
        return (this.getFlags() & jumpFlag) == jumpFlag;
    }

    public boolean isConditionalIns(){
        int conditionalFlag = PandaOPCodeFlag.CONDITIONAL.getValue();
        return (this.getFlags() & conditionalFlag) == conditionalFlag;
    }

    public boolean isThrow(){
        return this == THROW_PREF_NONE;
    }

    public boolean isTerminator(){
        return this.isJumpIns() || this.isReturnIns() || this.isThrow();
    }

    public int getInstructionSize(){
        int opcodeSize =  getCode() >= getLastInstruction().getCode() ? 2:1;
        return opcodeSize + getFormat().getParamSize();
    }
}
